<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tradeshow Meetings Assistant â€” Realtime</title>
  <style>
:root{
  /* palette */
  --bg:#19a4d0;
  --card:#ffffff;
  --text:#111827;
  --border:#e5e7eb;
  --primary:#19a4d0;
  --primary-hover:#148fb6;
  --primary-50:#e8f7fc;
  --blue:#19a4d0;

  /* tokens */
  --muted:#6b7280;
  --radius:14px;
  --shadow:0 1px 2px rgba(0,0,0,.06),0 1px 3px rgba(0,0,0,.1);
  --shadow-hover:0 6px 12px rgba(0,0,0,.18);
}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
    .container{padding:24px;max-width:1200px;margin:0 auto}
  
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
  
    .grid{display:grid;gap:24px}
    @media(min-width:1024px){.grid{grid-template-columns:1fr 2fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
    .card-h{padding:16px 16px 8px 16px;border-bottom:1px solid var(--border)}
    .card-h .title{font-weight:700;display:flex;gap:8px;align-items:center}
    .card-h .desc{font-size:12px;color:var(--muted);margin-top:4px}
    .card-c{padding:16px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .muted{color:var(--muted)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);background:#fff;border-radius:10px;cursor:pointer}
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .btn.icon{width:36px;height:36px;justify-content:center}
    .btn.sm{padding:6px 10px;font-size:12px}
 .btn[disabled], .btn[aria-disabled="true"]{opacity:.55;cursor:not-allowed;pointer-events:none}
    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px}
    .list{display:flex;flex-direction:column;gap:10px}
    .item{border:1px solid var(--border);border-radius:12px;background:#fff}
    .item-c{padding:12px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .item .title{font-size:13px;font-weight:600}
    .item .sub{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:38vw}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    input, textarea, select{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#fff}
    textarea{min-height:70px}
    .kicker{font-size:12px;font-weight:700;margin:8px 0}
    .attendee{border:1px solid var(--border);border-radius:12px;padding:10px}
    .avatar{width:44px;height:44px;border-radius:999px;background:#eee;display:inline-flex;align-items:center;justify-content:center}
    .hour-grid{border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .hour-row{display:grid;grid-template-columns:110px 1fr;border-bottom:1px solid var(--border)}
    .hour-row:last-child{border-bottom:none}
    .hour-label{padding:8px 12px;text-align:right;color:var(--muted);font-size:12px}
    .hour-cell{padding:8px 12px}
    .ghost{height:24px;border-radius:8px;background:var(--primary-50)}
    .meeting-pill{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px}
    .tools{display:flex;gap:8px;align-items:center}
    .tabs{display:inline-flex;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .tab{padding:6px 10px;border:0;background:#fff;cursor:pointer}
    .tab.active{background:var(--primary);color:#fff}
    .spacer{height:8px}
    .hidden{display:none}
    .hr{height:1px;background:var(--border);margin:12px 0}
    dialog{border:none;border-radius:14px;width:min(720px,96vw);} dialog::backdrop{background:rgba(0,0,0,.35)}
    .dialog-c{padding:16px} .dialog-actions{display:flex;justify-content:flex-end;gap:8px;padding:0 16px 16px}
    .link{color:var(--blue);text-decoration:underline}
    .flex{display:flex}.gap8{gap:8px}.gap12{gap:12px}.gap16{gap:16px}.col{display:flex;flex-direction:column}.wfull{width:100%}.end{justify-content:flex-end}
    .ae{border:1px solid var(--border);border-radius:12px;padding:10px}
.ae-grid{display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:flex-start}
.ae-avatar{width:44px;height:44px;border-radius:999px;background:#eee;display:flex;align-items:center;justify-content:center;overflow:hidden;font-weight:700}
.ae-avatar img{width:44px;height:44px;object-fit:cover;border-radius:999px}
.ae-two{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.ae-actions{display:flex;justify-content:flex-end;margin-top:8px}
    .ae-linkwrap{display:flex;gap:8px;align-items:center}
    /* === Blue background + interactive polish === */


header h1 { color:#fff; }
header .muted { color:rgba(255,255,255,.85); }
.head-left{ display:flex; align-items:center; gap:12px; }

/* Make the logo align well with the text */
h1{
  display:flex;
  font-size:22px;
  align-items:center;
  gap:10px;
  margin:0;
}
.brand-logo{
  height:24px;
  width:auto;
  object-fit:contain;
  border-radius:6px;
}

/* Hover lift for cards and list items */
.card{ transition: box-shadow .25s ease, transform .2s ease; }
.card:hover{ transform: translateY(-3px); box-shadow: var(--shadow-hover); }
.item{ transition: box-shadow .25s ease, transform .2s ease; }
.item:hover{ transform: translateY(-2px); box-shadow: var(--shadow-hover); }

/* Button hover polish */
.btn.primary{
  transition: transform .15s ease, box-shadow .2s ease, filter .15s ease;
}
.btn.primary:hover{
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
  filter: brightness(1.05);
  background:var(--primary-hover);
  border-color:var(--primary-hover);
}

/* Active tab hover */
.tab.active:hover{
  background:var(--primary-hover);
}
.topbar {
  display:flex;
  justify-content:flex-end;
  align-items:center;
  gap:8px;
  margin-bottom:12px;
}
    .topbar .muted { color: rgba(255,255,255,.85); }
  </style>
  
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<!-- Firebase init + tiny helpers -->
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAefJL7N3PBdQeGJWwjJZjfEQC8qUcpT5U",
    authDomain: "tradeshow-assistant.firebaseapp.com",
    projectId: "tradeshow-assistant",
    storageBucket: "tradeshow-assistant.firebasestorage.app",
    messagingSenderId: "865900601935",
    appId: "1:865900601935:web:82a7b49e70f8088d40003a"
  };

 if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  const db  = firebase.firestore();
  const COL = db.collection('tradeshow');

  // single-doc helpers for simple settings (GPT link, logo URL, etc.)
  async function getSharedDoc(docId, fallback) {
    const snap = await COL.doc(docId).get();
    return snap.exists ? snap.data().value : fallback;
  }
  async function setSharedDoc(docId, value) {
    return COL.doc(docId).set({ value }, { merge: true });
  }
  function onSharedDoc(docId, cb) {
    return COL.doc(docId).onSnapshot(s => { if (s.exists) cb(s.data().value); });
  }
</script>
  </head>
<body>
  <div class="container">
    <div id="gptTopBar" class="topbar">
  <a id="openGptTop" class="btn" aria-disabled="true" aria-label="Open your configured GPT">Open GPT</a>
  <span id="gptHintTop" class="muted">Add a GPT link</span>
</div>
    <header>
      <div class="head-left brand">
        <img id="brandLogo" class="brand-logo hidden" alt="Logo" />
        <h1>Tradeshow Meetings Assistant â€” Realtime</h1>
      </div>
      <div class="tools">
        <div class="tabs">
          <button id="tabAgenda" class="tab active">Agenda</button>
          <button id="tabHourly" class="tab">Hourly</button>
        </div>
   
        <button id="setGptBtn" class="btn">Set GPT Link</button>
     
        <button id="setLogoBtn" class="btn">Set Logo</button>
        <button id="addMeetingBtn" class="btn primary">+ New meeting</button>
      </div>
    </header>

    <div class="row">
      <button id="prevDay" class="btn icon">â—€</button>
      <div id="activeDateLbl" class="chip">â€”</div>
      <button id="nextDay" class="btn icon">â–¶</button>
    </div>

    <div class="grid">
      <div>
        <div id="agendaList" class="list"></div>
        <div id="hourlyGrid" class="hidden"></div>
        <div class="hr"></div>
        <div id="travelSection"></div>
        <div class="spacer"></div>
        <div id="importExport"></div>
      </div>
      <div id="detailsCol"></div>
    </div>
  </div>

  <!-- Meeting dialog -->
  <dialog id="meetingDialog">
    <div class="dialog-c">
      <div id="dlgTitle" class="kicker">New meeting</div>
      <div class="two">
        <input id="m_title" placeholder="Title" />
        <input id="m_location" placeholder="Location" />
      </div>
      <div class="two">
        <input id="m_booth" placeholder="Booth (optional)" />
        <input id="m_start" type="datetime-local" />
      </div>
      <div class="two">
        <input id="m_end" type="datetime-local" />
        <input disabled placeholder="â€”" />
      </div>
      <textarea id="m_desc" placeholder="Description"></textarea>

      <div class="kicker">Attendees</div>
      <div id="attendeeEditor" class="col gap8"></div>
      <div class="ae-actions">
        <button id="addAttendeeBtn" class="btn sm">+ Add attendee</button>
      </div>
    </div>
    <div class="dialog-actions">
      <button id="dlgCancel" class="btn">Cancel</button>
      <button id="dlgSave" class="btn primary">Save</button>
    </div>
  </dialog>

  <!-- Travel dialog -->
  <dialog id="travelDialog">
    <div class="dialog-c">
      <div class="two">
        <select id="t_type">
          <option value="flight">Flight</option>
          <option value="hotel">Hotel</option>
          <option value="car">Car</option>
          <option value="other">Other</option>
        </select>
        <input id="t_label" placeholder="Label" />
      </div>
      <div class="two">
        <input id="t_conf" placeholder="Confirmation (optional)" />
        <input id="t_details" placeholder="Details (optional)" />
      </div>
      <div class="two">
        <input id="t_start" type="datetime-local" />
        <input id="t_end" type="datetime-local" />
      </div>
    </div>
    <div class="dialog-actions">
      <button id="t_cancel" class="btn">Cancel</button>
      <button id="t_save" class="btn primary">Save</button>
    </div>
  </dialog>

  <!-- Logo dialog -->
  <dialog id="logoDialog">
    <div class="dialog-c">
      <input id="logoInput" placeholder="https://example.com/logo.png" />
    </div>
    <div class="dialog-actions">
      <button id="logoCancel" class="btn">Cancel</button>
      <button id="logoSave" class="btn primary">Save</button>
    </div>
  </dialog>

  <!-- GPT link dialog -->
  <dialog id="gptDialog">
    <div class="dialog-c">
      <input id="gptInput" placeholder="https://chat.openai.com/g/gpt-your-tool" />
    </div>
    <div class="dialog-actions">
      <button id="gptCancel" class="btn">Cancel</button>
      <button id="gptSave" class="btn primary">Save</button>
    </div>
  </dialog>
    <script>
const $  = (sel, root=document) => root.querySelector(sel);
const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
// Small utils used globally
const uid = () => Math.random().toString(36).slice(2, 9);
  // ----------- App state -----------
  let meetings = [];
  let travel   = [];
  let gptUrl   = "";
  let logoUrl  = "";
  let activeDate = new Date().toISOString();
  let view = "agenda";

  // ----------- Elements -----------
  const activeDateLbl = $("#activeDateLbl");
  const prevDayBtn = $("#prevDay");
  const nextDayBtn = $("#nextDay");
  const tabAgenda = $("#tabAgenda");
  const tabHourly = $("#tabHourly");
  const agendaList = $("#agendaList");
  const hourlyGrid = $("#hourlyGrid");
  const addMeetingBtn = $("#addMeetingBtn");
  const detailsCol = $("#detailsCol");

  const setGptBtn = $("#setGptBtn");

  const travelSection = $("#travelSection");
const openGptATop = $("#openGptTop");
const gptHintTop  = $("#gptHintTop");
  // Logo bits
  const brandLogo  = $("#brandLogo");
  const setLogoBtn = $("#setLogoBtn");
  const logoDialog = $("#logoDialog");
  const logoInput  = $("#logoInput");
  const logoSave   = $("#logoSave");
  const logoCancel = $("#logoCancel");

  // Meeting dialog
  const meetingDialog = $("#meetingDialog");
  const dlgSave = $("#dlgSave");
  const dlgCancel = $("#dlgCancel");
  const dlgTitle = $("#dlgTitle");
  const m_title = $("#m_title");
  const m_location = $("#m_location");
  const m_booth = $("#m_booth");
  const m_start = $("#m_start");
  const m_end = $("#m_end");
  const m_desc = $("#m_desc");
  const attendeeEditorRoot = $("#attendeeEditor");
  const addAttendeeBtn = $("#addAttendeeBtn");
  let currentAttendees = [];
  const blankAttendee = () => ({ id: uid(), name:"", title:"", company:"", linkedin:"", photoUrl:"", notes:"" });
const toLocalInput = (d) => {
  const dt = new Date(d);
  dt.setMinutes(dt.getMinutes() - dt.getTimezoneOffset());
  return dt.toISOString().slice(0,16);
};
  // Travel dialog
  const travelDialog = $("#travelDialog");
  const t_type = $("#t_type");
  const t_label = $("#t_label");
  const t_conf = $("#t_conf");
  const t_details = $("#t_details");
  const t_start = $("#t_start");
  const t_end = $("#t_end");
  const t_save = $("#t_save");
  const t_cancel = $("#t_cancel");
  // ----- Attendee editor (unchanged) -----
  function sanitizeUrl(u){ if(!u) return ""; let s=u.trim(); if(!/^https?:\/\//i.test(s)) s="https://"+s; return s; }
  function buildAttendeeRow(a){
    const wrap = document.createElement("div"); wrap.className = "ae"; wrap.dataset.id = a.id;
    const grid = document.createElement("div"); grid.className = "ae-grid";
    const avatar = document.createElement("div"); avatar.className = "ae-avatar";
    const initial = (a.name || "?").slice(0,1).toUpperCase();
    if (a.photoUrl) { const img=document.createElement("img"); img.src=a.photoUrl; avatar.append(img); } else { avatar.textContent=initial; }
    const right = document.createElement("div"); right.className = "col gap8";
    const row1 = document.createElement("div"); row1.className = "ae-two";
    const inName = document.createElement("input"); inName.placeholder="Full name"; inName.value=a.name||"";
    const inTitle= document.createElement("input"); inTitle.placeholder="Job title"; inTitle.value=a.title||"";
    const row2 = document.createElement("div"); row2.className = "ae-two";
    const inCompany = document.createElement("input"); inCompany.placeholder="Company"; inCompany.value=a.company||"";
    const linkWrap = document.createElement("div"); linkWrap.className="ae-linkwrap";
    const inLinkedin = document.createElement("input"); inLinkedin.placeholder="LinkedIn URL (https://â€¦)"; inLinkedin.value=a.linkedin||"";
    const btnOpen=document.createElement("button"); btnOpen.className="btn sm"; btnOpen.type="button"; btnOpen.textContent="ðŸ”— Open"; btnOpen.disabled=!inLinkedin.value.trim();
    btnOpen.onclick=()=>{ const url=sanitizeUrl(inLinkedin.value); if(!url) return; window.open(url,"_blank","noopener,noreferrer"); };
    inLinkedin.addEventListener("input",()=>{ btnOpen.disabled=!inLinkedin.value.trim(); });
    linkWrap.append(inLinkedin, btnOpen);
    const inPhoto=document.createElement("input"); inPhoto.placeholder="Photo URL (optional)"; inPhoto.value=a.photoUrl||"";
    const inNotes=document.createElement("textarea"); inNotes.placeholder="Notes"; inNotes.value=a.notes||"";
    const actions = document.createElement("div"); actions.className="ae-actions";
    const btnRemove = document.createElement("button"); btnRemove.className="btn sm"; btnRemove.textContent="ðŸ—‘ï¸ Remove";
    btnRemove.onclick=()=>{ currentAttendees=currentAttendees.filter(x=>x.id!==a.id); renderAttendeeEditor(currentAttendees); };
    inPhoto.addEventListener("input", ()=>{ a.photoUrl=inPhoto.value.trim(); avatar.innerHTML=""; if(a.photoUrl){ const img2=document.createElement("img"); img2.src=a.photoUrl; avatar.append(img2);} else { avatar.textContent=(inName.value||"?").slice(0,1).toUpperCase(); }});
    inName.addEventListener("input", ()=>{ if(!inPhoto.value.trim()){ avatar.textContent=(inName.value||"?").slice(0,1).toUpperCase(); }});
    row1.append(inName, inTitle); row2.append(inCompany, linkWrap); right.append(row1,row2,inPhoto,inNotes);
    actions.append(btnRemove); grid.append(avatar,right); wrap.append(grid,actions); return wrap;
  }
       function renderAttendeeEditor(list){
    attendeeEditorRoot.innerHTML=""; if(!list || !list.length){ const empty=document.createElement("div"); empty.className="muted"; empty.textContent="No attendees yet."; attendeeEditorRoot.append(empty); return;}
    list.forEach(a=> attendeeEditorRoot.append(buildAttendeeRow(a)));
  }
  function collectAttendeesFromEditor(){
    return Array.from(attendeeEditorRoot.querySelectorAll(".ae")).map(row=>{
      const id=row.dataset.id; const [inName,inTitle,inCompany,inLinkedin,inPhoto,inNotes]=row.querySelectorAll("input, textarea");
      return { id, name:(inName.value||"").trim(), title:(inTitle.value||"").trim(), company:(inCompany.value||"").trim(), linkedin:(inLinkedin.value||"").trim(), photoUrl:(inPhoto.value||"").trim(), notes:(inNotes.value||"").trim() };
    });
  }
  (function () {

  const fmtTime = (iso) => new Date(iso).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
  const fmtDate = (iso) => new Date(iso).toLocaleDateString([], { year: "numeric", month: "short", day: "2-digit" });
  const sameDay = (aISO, bISO) => {
    const a = new Date(aISO), b = new Date(bISO);
    return a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate();
  };
  const hoursBetween = (startISO, endISO) => (new Date(endISO) - new Date(startISO)) / (1000*60*60);

  // ----------- Seeds -----------
  const seedDate = (() => { const now = new Date(); return new Date(now.getFullYear(), 8, 16, 9, 0, 0); })();
  const SAMPLE_ATTENDEES = [
    {id:uid(), name:"Chris Williams", title:"VP Partnerships", company:"NorthBridge", linkedin:"", photoUrl:"", notes:"Loves concise dashboards; ask about Zoho practice."},
    {id:uid(), name:"Amanda Lee",    title:"Head of Marketing", company:"Protocol80", linkedin:"", photoUrl:"", notes:"Interested in co-marketing webinars and case studies."},
    {id:uid(), name:"Hudson Carter", title:"Solutions Architect", company:"CloudTrailz", linkedin:"", photoUrl:"", notes:"Deep NetSuite background; prefers technical prep notes."},
  ];
  const SAMPLE_MEETINGS = [
    { id:uid(), title:"NorthBridge + Commercient intro", description:"Explore reseller fit; prioritize Zoho + Monday integrations.", location:"Hall B â€“ Meeting Room 3", booth:"B122",
      startISO:new Date(seedDate.getTime()).toISOString(), endISO:new Date(seedDate.getTime()+60*60*1000).toISOString(),
      attendees:[SAMPLE_ATTENDEES[0]], talkingPoints:"15% target shareâ€¦", prepChecklist:"Review Zohoâ€¦" },
    { id:uid(), title:"Protocol80 co-marketing sprint", description:"Finalize webinar topics and case study pipeline.", location:"Expo CafÃ© (near Hall A)", booth:"A210",
      startISO:new Date(seedDate.getTime()+2*60*60*1000).toISOString(), endISO:new Date(seedDate.getTime()+3*60*60*1000).toISOString(),
      attendees:[SAMPLE_ATTENDEES[1]], talkingPoints:"Partner Spotlightâ€¦", prepChecklist:"Bring sampleâ€¦" },
    { id:uid(), title:"CloudTrailz technical sync", description:"Deep-dive NetSuite<->HubSpot patterns; managed custom objects.", location:"Booth C341", booth:"C341",
      startISO:new Date(seedDate.getTime()+4*60*60*1000).toISOString(), endISO:new Date(seedDate.getTime()+5*60*60*1000).toISOString(),
      attendees:[SAMPLE_ATTENDEES[2]], talkingPoints:"QuickBooks Desktopâ€¦", prepChecklist:"Open architectureâ€¦" },
  ];
  const SAMPLE_TRAVEL = [
    {id:uid(), type:"flight", label:"ATL â†’ BOS (AC 1234)", confirmation:"Z7X9QW", startISO:new Date(seedDate.getTime()-24*60*60*1000).toISOString(), endISO:new Date(seedDate.getTime()-22*60*60*1000).toISOString(), details:"Seat 14C; carry-on only."},
    {id:uid(), type:"hotel",  label:"Westin Seaport, Boston", confirmation:"H987654", startISO:new Date(seedDate.getTime()-1*60*60*1000).toISOString(), endISO:new Date(seedDate.getTime()+2*24*60*60*1000).toISOString(), details:"Reservation under Commercient; breakfast included."},
  ];
 // ----------- Firestore refs (db, COL, getSharedDoc, setSharedDoc, onSharedDoc already defined in <head>) -----------
  const MEETINGS = COL.doc('meetings').collection('items');
  const TRAVEL   = COL.doc('travel').collection('items');

  function upsertMeeting(m) { return MEETINGS.doc(m.id).set(m, { merge: true }); }
  function deleteMeeting(id) { return MEETINGS.doc(id).delete(); }
  function upsertTravel (t) { return TRAVEL.doc(t.id).set(t, { merge: true }); }
  function deleteTravel (id){ return TRAVEL.doc(id).delete(); }

  // ----- UI renders -----
  function daysFromMeetings(list){
    const unique = Array.from(new Set(list.map(m => new Date(m.startISO).toDateString())));
    return unique.map(d => new Date(d)).sort((a,b)=>a-b);
  }
  function shiftDay(dir){
    const days = daysFromMeetings(meetings);
    const idx = days.findIndex(d => sameDay(d.toISOString(), activeDate));
    const next = days[idx+dir];
    if(next) activeDate = next.toISOString();
    renderAll();
  }
  function renderHeaderControls(){
    activeDateLbl.textContent = fmtDate(activeDate);
    tabAgenda.classList.toggle("active", view==="agenda");
    tabHourly.classList.toggle("active", view==="hourly");
  }

  function renderAgenda(){
    agendaList.innerHTML = "";
    const dayMeetings = meetings.filter(m => sameDay(m.startISO, activeDate)).sort((a,b)=> new Date(a.startISO)-new Date(b.startISO));
    if(!dayMeetings.length){ const div=document.createElement("div"); div.className="muted"; div.textContent="No meetings for this date."; agendaList.append(div); }
    dayMeetings.forEach(m=>{
      const card=document.createElement("div"); card.className="item";
      const c=document.createElement("div"); c.className="item-c";
      const left=document.createElement("div");
      const title=document.createElement("div"); title.className="title"; title.textContent = `${fmtTime(m.startISO)}â€“${fmtTime(m.endISO)} â€¢ ${m.title}`;
      const sub=document.createElement("div"); sub.className="sub"; sub.textContent   = `${m.location || ""}${m.booth ? ` â€¢ Booth ${m.booth}` : ""}`;
      left.append(title, sub);
      const tools=document.createElement("div"); tools.className="tools";
      const edit=document.createElement("button"); edit.className="btn sm"; edit.textContent="âœï¸"; edit.onclick=()=> openMeetingDialog(m);
      const del=document.createElement("button"); del.className="btn sm"; del.textContent="ðŸ—‘ï¸";
      del.onclick=async ()=>{ if(!confirm("Delete this meeting?")) return; try{ await deleteMeeting(m.id);}catch(err){ console.error(err); alert("Delete failed."); } };
      tools.append(edit,del); c.append(left,tools); card.append(c); agendaList.append(card);
    });
  }

  function renderHourly(){
    hourlyGrid.innerHTML = "";
    const dayMeetings = meetings.filter(m => sameDay(m.startISO, activeDate)).sort((a,b)=> new Date(a.startISO)-new Date(b.startISO));
    const wrap=document.createElement("div"); wrap.className="hour-grid";
    const start=new Date(activeDate); start.setHours(7,0,0,0);
    for(let i=0;i<13;i++){
      const h=new Date(start.getTime()+i*60*60*1000);
      const row=document.createElement("div"); row.className="hour-row";
      const lbl=document.createElement("div"); lbl.className="hour-label"; lbl.textContent=h.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
      const cell=document.createElement("div"); cell.className="hour-cell";
      const slot=dayMeetings.filter(m => new Date(m.startISO)<=h && new Date(m.endISO)>h);
      if(!slot.length){ const g=document.createElement("div"); g.className="ghost"; cell.append(g); }
      else{
        const box=document.createElement("div"); box.style.display="flex"; box.style.flexWrap="wrap"; box.style.gap="8px";
        slot.forEach(m=>{ const pill=document.createElement("span"); pill.className="meeting-pill"; pill.innerHTML = `<strong>${m.title}</strong> <span class="muted">${fmtTime(m.startISO)}â€“${fmtTime(m.endISO)}</span>`;
                            box.append(pill);
  });

        cell.append(box);
      }
      row.append(lbl,cell); wrap.append(row);
    }
    hourlyGrid.append(wrap);
  }

  function renderDetails(){
    detailsCol.innerHTML = "";
    const dayMeetings = meetings.filter(m => sameDay(m.startISO, activeDate)).sort((a,b)=> new Date(a.startISO)-new Date(b.startISO));
    if(!dayMeetings.length){
      const card=document.createElement("div"); card.className="card";
      card.innerHTML = `<div class="card-h"><div class="title">No meetings this day</div></div><div class="card-c muted">Add one using the button on the left.</div>`;
      detailsCol.append(card); return;
    }
    dayMeetings.forEach(m=>{
      const card=document.createElement("div"); card.className="card";
      const head=document.createElement("div"); head.className="card-h";
      const t=document.createElement("div"); t.className="title row";
      const left=document.createElement("span"); left.textContent=m.title;
      const right=document.createElement("span"); right.className="muted";right.textContent = `${fmtDate(m.startISO)} â€¢ ${fmtTime(m.startISO)}â€“${fmtTime(m.endISO)}`;
      t.append(left,right);
      const desc=document.createElement("div"); desc.className="desc";desc.textContent  = `${hoursBetween(m.startISO, m.endISO).toFixed(1)} hrs â€¢ ${m.location || ""}${m.booth ? ` â€¢ Booth ${m.booth}` : ""}`;
      head.append(t,desc);

      const c=document.createElement("div"); c.className="card-c";
      const inner=document.createElement("div"); inner.className="grid"; inner.style.gridTemplateColumns="1fr 2fr"; inner.style.gap="16px";

      const leftCol=document.createElement("div");
      if(m.description){ const p=document.createElement("p"); p.textContent=m.description; leftCol.append(p); }
      if(m.talkingPoints){ const k=document.createElement("div"); k.className="kicker"; k.textContent="Suggested talking points";
        const box=document.createElement("div"); box.style.background="var(--primary-50)"; box.style.borderRadius="12px"; box.style.padding="12px"; box.textContent=m.talkingPoints; leftCol.append(k,box); }
      if(m.prepChecklist){ const k=document.createElement("div"); k.className="kicker"; k.textContent="Prep checklist";
        const box=document.createElement("div"); box.style.background="var(--primary-50)"; box.style.borderRadius="12px"; box.style.padding="12px"; box.textContent=m.prepChecklist; leftCol.append(k,box); }
      const edit=document.createElement("button"); edit.className="btn"; edit.textContent="âœï¸ Edit details"; edit.onclick=()=> openMeetingDialog(m);
      leftCol.append(edit);

      const rightCol=document.createElement("div");
      const ak=document.createElement("div"); ak.className="kicker"; ak.textContent="Attendees"; rightCol.append(ak);
      (m.attendees||[]).forEach(a=>{
        const wrap=document.createElement("div"); wrap.className="attendee";
        const row=document.createElement("div"); row.className="row";
        const who=document.createElement("div"); who.className="row"; who.style.gap="12px";
        const av=document.createElement("div"); av.className="avatar"; av.textContent=(a.name||"?").slice(0,1).toUpperCase();
        const meta=document.createElement("div"); const nm=document.createElement("div"); nm.style.fontWeight="600"; nm.textContent=a.name;
        const sub=document.createElement("div"); sub.className="muted"; sub.style.fontSize="12px"; sub.textContent=[a.title,a.company].filter(Boolean).join(" â€¢ ");
        meta.append(nm,sub); who.append(av,meta);
        const link=document.createElement("a"); link.className="link"; link.textContent="LinkedIn"; link.target="_blank"; link.rel="noreferrer";
        if(a.linkedin) link.href=a.linkedin; else { link.href="#"; link.style.pointerEvents="none"; link.style.opacity=".5"; }
        row.append(who,link);
        if(a.notes){ const notes=document.createElement("div"); notes.style.marginTop="6px"; notes.textContent=a.notes; wrap.append(row, notes); }
        else wrap.append(row);
        rightCol.append(wrap);
      });

      inner.append(rightCol,leftCol); // attendees on left? flip if you like
      c.append(inner); card.append(head,c); detailsCol.append(card);
    });
  }

  function renderTravel(){
    const root=travelSection; root.innerHTML="";
    const add=document.createElement("button"); add.className="btn"; add.textContent="âž• Add travel";
    add.onclick=()=>{ t_type.value="flight"; t_label.value=""; t_conf.value=""; t_details.value=""; t_start.value=""; t_end.value=""; travelDialog.dataset.editId=""; travelDialog.showModal(); };
    root.append(add); root.append(document.createElement("div")).className="spacer";

    if(!travel.length){ const div=document.createElement("div"); div.className="muted"; div.textContent="No travel saved."; root.append(div); return; }

    travel.forEach(t=>{
      const row=document.createElement("div"); row.className="item";
      const inner=document.createElement("div"); inner.className="item-c";
      const left=document.createElement("div");
      const head=document.createElement("div"); head.className="title";head.textContent = `[${t.type?.toUpperCase() || ""}] ${t.label}`;
      const sub=document.createElement("div"); sub.className="muted"; sub.style.fontSize="12px";
const bits = [];
if (t.confirmation) bits.push(`Conf#: ${t.confirmation}`);
if (t.startISO)     bits.push(`Start ${fmtDate(t.startISO)} ${fmtTime(t.startISO)}`);
if (t.endISO)       bits.push(`End ${fmtDate(t.endISO)} ${fmtTime(t.endISO)}`);
sub.textContent = bits.join(" â€¢ ");
      if(t.details){ const d=document.createElement("div"); d.style.fontSize="12px"; d.textContent=t.details; left.append(head, sub, d); } else { left.append(head, sub); }
  const tools=document.createElement("div"); tools.className="tools";
const edit=document.createElement("button"); edit.className="btn sm"; edit.textContent="âœï¸";
edit.onclick = () => {
  t_type.value = t.type;
  t_label.value = t.label;
  t_conf.value = t.confirmation || "";
  t_details.value = t.details || "";
  t_start.value = t.startISO ? toLocalInput(t.startISO) : "";
  t_end.value   = t.endISO   ? toLocalInput(t.endISO)   : "";
  travelDialog.dataset.editId = t.id;
  travelDialog.showModal();
};
const del=document.createElement("button"); del.className="btn sm"; del.textContent="ðŸ—‘ï¸";
del.onclick = async () => {
  if(!confirm("Delete this travel item?")) return;
  try { await deleteTravel(t.id); } 
  catch(err){ console.error(err); alert("Delete failed."); }
};
tools.append(edit, del);
inner.append(left, tools);
      row.append(inner);
root.append(row);
}); 

}
  function setGptEl(el, hintEl){
  if(!el) return;
  if (gptUrl){
    el.href = gptUrl;
    el.target = "_blank";
    el.rel = "noopener noreferrer";
    el.removeAttribute("aria-disabled");
    el.removeAttribute("disabled");
    if (hintEl) hintEl.style.display = "none";
  } else {
    el.removeAttribute("href");
    el.removeAttribute("target");
    el.removeAttribute("rel");
    el.setAttribute("aria-disabled","true");
    el.setAttribute("disabled","");
    if (hintEl) hintEl.style.display = "block";
  }
}
function renderGpt(){
  setGptEl(openGptATop, gptHintTop);
}
  function renderLogo(){
    if (logoUrl){ brandLogo.src=logoUrl; brandLogo.classList.remove("hidden"); }
    else { brandLogo.removeAttribute("src"); brandLogo.classList.add("hidden"); }
    if (setLogoBtn) setLogoBtn.classList.toggle("hidden", !!logoUrl);
  }

  function renderAll(){
    renderHeaderControls();
    if(view==="agenda"){ agendaList.classList.remove("hidden"); hourlyGrid.classList.add("hidden"); renderAgenda(); }
    else               { hourlyGrid.classList.remove("hidden"); agendaList.classList.add("hidden"); renderHourly(); }
    renderDetails();
    renderTravel();
    renderGpt();
    renderLogo();
    renderImportExport();
  }

  // ----- Meeting dialog open/save -----
  function openMeetingDialog(m){
    meetingDialog.dataset.editId = m?.id || "";
    dlgTitle.textContent = m ? "Edit meeting" : "New meeting";
    m_title.value = m?.title || "";
    m_location.value = m?.location || "";
    m_booth.value = m?.booth || "";
    m_start.value = toLocalInput(m ? m.startISO : new Date());
    m_end.value   = toLocalInput(m ? m.endISO   : new Date(Date.now()+60*60*1000));
    m_desc.value  = m?.description || "";
    currentAttendees = Array.isArray(m?.attendees) ? structuredClone(m.attendees) : [];
    renderAttendeeEditor(currentAttendees);
    addAttendeeBtn.onclick = ()=>{ currentAttendees=[...currentAttendees, blankAttendee()]; renderAttendeeEditor(currentAttendees); };
    meetingDialog.showModal();
  }
  async function saveMeetingFromDialog(){
    const id = meetingDialog.dataset.editId;
    const payload = {
      id: id || uid(),
      title: m_title.value.trim(),
      location: m_location.value.trim(),
      booth: m_booth.value.trim(),
      startISO: new Date(m_start.value).toISOString(),
      endISO:   new Date(m_end.value).toISOString(),
      attendees: collectAttendeesFromEditor(),
      description: m_desc.value.trim(),
    };
    if(!payload.title){ alert("Title required"); return; }
     if (new Date(m_end.value) <= new Date(m_start.value)) {
      alert("End time must be after start time."); return;
    }
     try { await upsertMeeting(payload); meetingDialog.close(); }
     catch(err){ console.error('Save failed', err); alert('Cloud save failed.'); }
   }
  // ----- Import/Export -----
  function renderImportExport(){
    const root=document.createElement("div");
    const inp=document.createElement("input"); inp.type="file"; inp.accept="application/json"; inp.className="hidden";
    const btnImport=document.createElement("button"); btnImport.className="btn sm"; btnImport.textContent="â¬†ï¸ Import";
    const btnExport=document.createElement("button"); btnExport.className="btn sm"; btnExport.textContent="â¬‡ï¸ Export";
    btnImport.onclick=()=>inp.click();
    inp.onchange = async (e)=>{
      const f=e.target.files?.[0]; if(!f) return;
      const text=await f.text();
      try{
        const parsed=JSON.parse(text);
        // Replace ALL meetings
        if(Array.isArray(parsed.meetings)){
          const snap=await MEETINGS.get(); const batch=db.batch();
          snap.forEach(doc=> batch.delete(doc.ref));
          parsed.meetings.forEach(m=>{ const id=m.id || uid(); batch.set(MEETINGS.doc(id), { ...m, id }); });
          await batch.commit();
        }
        // Replace ALL travel
        if(Array.isArray(parsed.travel)){
          const snapTr=await TRAVEL.get(); const batchTr=db.batch();
          snapTr.forEach(doc=> batchTr.delete(doc.ref));
          parsed.travel.forEach(t=>{ const id=t.id || uid(); batchTr.set(TRAVEL.doc(id), { ...t, id }); });
          await batchTr.commit();
        }
        if('gptUrl' in parsed)  await setSharedDoc('gptUrl',  parsed.gptUrl  || '');
        if('logoUrl' in parsed) await setSharedDoc('logoUrl', parsed.logoUrl || '');
      }catch(err){ console.error(err); alert("Invalid JSON file"); }
    };
   btnExport.onclick = () => {
  const blob = new Blob([JSON.stringify({ meetings, travel, gptUrl, logoUrl }, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `tradeshow-data-${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  URL.revokeObjectURL(url);
};

root.append(btnImport, btnExport, inp);
$("#importExport").innerHTML = "";
$("#importExport").append(root);
    }

  // ----- Events -----
  prevDayBtn.onclick = ()=> shiftDay(-1);
  nextDayBtn.onclick = ()=> shiftDay(1);
  tabAgenda.onclick  = ()=>{ view="agenda"; renderAll(); };
  tabHourly.onclick  = ()=>{ view="hourly"; renderAll(); };
  addMeetingBtn.onclick = ()=> openMeetingDialog();
  dlgCancel.onclick = ()=> meetingDialog.close();
  dlgSave.onclick   = ()=> saveMeetingFromDialog();

  setGptBtn.onclick = async ()=>{ const gptDialog=$("#gptDialog"), gptInput=$("#gptInput"), gptSave=$("#gptSave"), gptCancel=$("#gptCancel");
    gptInput.value=gptUrl||""; gptDialog.showModal();
    gptCancel.onclick=()=> gptDialog.close();
    gptSave.onclick=async ()=>{ gptUrl=(gptInput.value||"").trim(); await setSharedDoc('gptUrl', gptUrl); gptDialog.close(); };
  };

  t_cancel.onclick = ()=> travelDialog.close();
   t_save.onclick   = async ()=>{
    const id = travelDialog.dataset.editId;
    if (t_start.value && t_end.value && new Date(t_end.value) < new Date(t_start.value)) {
      alert("Travel end must be after start."); return;
    }
    const payload = {
      id: id || uid(),
      type: t_type.value,
      label: t_label.value.trim(),
    };
    const conf = t_conf.value.trim();
    if (conf) payload.confirmation = conf;
    const det = t_details.value.trim();
    if (det) payload.details = det;
    if (t_start.value) payload.startISO = new Date(t_start.value).toISOString();
    if (t_end.value)   payload.endISO   = new Date(t_end.value).toISOString();
    if(!payload.label){ alert("Label required"); return; }
    try{ await upsertTravel(payload); travelDialog.close(); }
    catch(err){ console.error('Save travel failed', err); alert('Save failed.'); }
  };
  setLogoBtn?.addEventListener('click', ()=>{ logoInput.value = logoUrl || ''; logoDialog.showModal(); });
  logoCancel?.addEventListener('click', ()=> logoDialog.close());
  logoSave?.addEventListener('click', async ()=>{
    logoUrl = (logoInput.value || '').trim();
    await setSharedDoc('logoUrl', logoUrl);
    logoDialog.close();
  });

  // ----- Init (async) -----
  (async function init(){
    // settings initial read
    gptUrl  = (await getSharedDoc('gptUrl',  "")) || "";
    logoUrl = (await getSharedDoc('logoUrl', "")) || "";
    renderGpt(); renderLogo();

    // live settings
onSharedDoc('gptUrl', v => {
  gptUrl = v || "";
  renderGpt();
  renderDetails(); // if you want detail cards to react to link changes in future
});
    onSharedDoc('logoUrl', v => { logoUrl = v || ""; renderLogo(); });

    // realtime meetings
    MEETINGS.orderBy('startISO').onSnapshot(async snap=>{
      if (snap.empty){
        const batch=db.batch(); SAMPLE_MEETINGS.forEach(m=> batch.set(MEETINGS.doc(m.id), m)); await batch.commit(); return;
      }
      meetings = snap.docs.map(d=>d.data());
      if(!meetings.find(m=> sameDay(m.startISO, activeDate)) && meetings.length) activeDate = meetings[0].startISO;
      renderAll();
    });

    // realtime travel
    TRAVEL.orderBy('startISO').onSnapshot(async snap=>{
      if (snap.empty){
        const batch=db.batch(); SAMPLE_TRAVEL.forEach(t=> batch.set(TRAVEL.doc(t.id), t)); await batch.commit(); return;
      }
      travel = snap.docs.map(d=>d.data());
      renderTravel();
    });

    renderAll(); // first paint
  })();
})();
</script>
</body>
</html>
